{"version":3,"file":"useControllableReducer.js","sources":["../../../../../../node_modules/@mui/base/ListboxUnstyled/useControllableReducer.js"],"sourcesContent":["import * as React from 'react';\nimport { unstable_useControlled as useControlled } from '@mui/utils';\nimport { ActionTypes } from './useListbox.types';\nimport areArraysEqual from '../utils/areArraysEqual';\n/**\n * Triggers change event handlers when reducer returns changed state.\n */\n\nfunction useReducerReturnValueHandler(state, value, options, optionComparer, setValueState, onValueChange, onHighlightChange) {\n  const valueRef = React.useRef(value);\n  valueRef.current = value;\n  const onValueChangeRef = React.useRef(onValueChange);\n  React.useEffect(() => {\n    onValueChangeRef.current = onValueChange;\n  }, [onValueChange]);\n  const onHighlightChangeRef = React.useRef(onHighlightChange);\n  React.useEffect(() => {\n    onHighlightChangeRef.current = onHighlightChange;\n  }, [onHighlightChange]);\n  React.useEffect(() => {\n    if (Array.isArray(state.selectedValue)) {\n      if (areArraysEqual(state.selectedValue, valueRef.current)) {\n        return;\n      }\n    } else if (state.selectedValue == null && valueRef.current == null || state.selectedValue != null && valueRef.current != null && optionComparer.current(state.selectedValue, valueRef.current)) {\n      return;\n    }\n\n    setValueState(state.selectedValue);\n\n    if (state.selectedValue != null) {\n      var _onValueChangeRef$cur;\n\n      // @ts-ignore We know that selectedValue has the correct type depending on `selectMultiple` prop.\n      (_onValueChangeRef$cur = onValueChangeRef.current) == null ? void 0 : _onValueChangeRef$cur.call(onValueChangeRef, state.selectedValue);\n    }\n  }, [state.selectedValue, setValueState, optionComparer]);\n  React.useEffect(() => {\n    var _onHighlightChangeRef;\n\n    // Fire the highlightChange event when reducer returns changed `highlightedIndex`.\n    (_onHighlightChangeRef = onHighlightChangeRef.current) == null ? void 0 : _onHighlightChangeRef.call(onHighlightChangeRef, state.highlightedValue);\n  }, [state.highlightedValue]);\n}\n\nexport default function useControllableReducer(internalReducer, externalReducer, props) {\n  const {\n    value: controlledValue,\n    defaultValue,\n    onChange: onValueChange,\n    onHighlightChange,\n    options,\n    optionComparer\n  } = props;\n  const propsRef = React.useRef(props);\n  propsRef.current = props;\n  const [value, setValueState] = useControlled({\n    controlled: controlledValue,\n    default: defaultValue,\n    name: 'useListbox'\n  });\n  const previousValueRef = React.useRef(null);\n  const [state, dispatch] = React.useReducer(externalReducer != null ? externalReducer : internalReducer, {\n    highlightedValue: null,\n    selectedValue: value\n  });\n  const optionComparerRef = React.useRef(optionComparer);\n  optionComparerRef.current = optionComparer;\n  React.useEffect(() => {\n    // Detect external changes to the controlled `value` prop and update the state.\n    if (controlledValue === undefined) {\n      return;\n    }\n\n    if (Array.isArray(controlledValue) && Array.isArray(previousValueRef.current) && areArraysEqual(previousValueRef.current, controlledValue, optionComparerRef.current)) {\n      // `value` is an array and it did not change.\n      return;\n    }\n\n    if (!Array.isArray(controlledValue) && controlledValue != null && previousValueRef.current != null && optionComparerRef.current(controlledValue, previousValueRef.current)) {\n      // `value` is a single option and it did not change.\n      return;\n    }\n\n    previousValueRef.current = controlledValue;\n    dispatch({\n      type: ActionTypes.setValue,\n      value: controlledValue\n    });\n  }, [controlledValue]);\n  useReducerReturnValueHandler(state, value, options, optionComparerRef, setValueState, onValueChange, onHighlightChange);\n  return [state, dispatch];\n}"],"names":["React","areArraysEqual","useControlled","ActionTypes"],"mappings":"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"}